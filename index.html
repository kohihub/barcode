<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Leitor de Dispositivos</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Etiquetas Escaneadas</h2>
  <input type="text" id="codigoInput" placeholder="Digite ou escaneie um cÃ³digo">
  <button onclick="enviarCodigo()">Enviar</button>
  <button onclick="copiarDeviceIDs()">ðŸ“‹ Copiar DeviceIDs</button>

  <div id="lista"></div>

  <script>
    // ðŸ”¥ ConfiguraÃ§Ã£o Firebase (troca pelos seus dados)
  const firebaseConfig = {
    apiKey: "AIzaSyC2eUz5iTUURydrdi4So1uPmQs9esGFe_E",
    authDomain: "pitzi-cel-barcode.firebaseapp.com",
    projectId: "pitzi-cel-barcode",
    storageBucket: "pitzi-cel-barcode.firebasestorage.app",
    messagingSenderId: "196032039906",
    appId: "1:196032039906:web:1bc78ed983bbb7b07387bb"
  };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let etiquetaAtual = { imei: null, deviceid: null, productid: null, srid: null };

    function classificarCodigo(codigo) {
      if (/^\d{15}$/.test(codigo)) return "imei";
      if (/^\d{7}$/.test(codigo)) return "deviceid";
      if (/^\d{4}$/.test(codigo)) return "productid";
      if (/^\d{5}$/.test(codigo)) return "srid";
      return null;
    }

    async function enviarCodigo() {
      const input = document.getElementById("codigoInput");
      const codigo = input.value.trim();
      input.value = "";

      const tipo = classificarCodigo(codigo);
      if (!tipo) {
        alert("CÃ³digo invÃ¡lido");
        return;
      }

      etiquetaAtual[tipo] = codigo;

      // Se todos os campos estiverem preenchidos, salva no Firestore
      if (etiquetaAtual.imei && etiquetaAtual.deviceid && etiquetaAtual.productid && etiquetaAtual.srid) {
        await db.collection("etiquetas").add(etiquetaAtual);
        etiquetaAtual = { imei: null, deviceid: null, productid: null, srid: null };
      }
    }

    // Escuta em tempo real
    db.collection("etiquetas").orderBy("imei").onSnapshot(snapshot => {
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      snapshot.forEach(doc => {
        const e = doc.data();
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.margin = "5px";
        div.style.padding = "5px";
        div.innerHTML = `
          <strong>IMEI:</strong> ${e.imei}<br>
          <strong>DeviceID:</strong> ${e.deviceid}<br>
          <strong>ProductID:</strong> ${e.productid}<br>
          <strong>SRID:</strong> ${e.srid}
        `;
        lista.appendChild(div);
      });
    });

    // BotÃ£o para copiar todos os DeviceIDs
    async function copiarDeviceIDs() {
      const snapshot = await db.collection("etiquetas").get();
      let ids = [];
      snapshot.forEach(doc => {
        const e = doc.data();
        if (e.deviceid) ids.push(e.deviceid);
      });
      const texto = ids.join("\n");
      await navigator.clipboard.writeText(texto);
      alert("DeviceIDs copiados!");
    }
  </script>
</body>
</html>
